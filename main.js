(()=>{"use strict";function e(e,t){e.classList.add(t),e.setAttribute("disabled","disabled")}var t,n=function(t,n,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t),e.removeAttribute("disabled")}(n,r.inactiveButtonClass):e(n,r.inactiveButtonClass)},r=document.querySelector(".popup_type_editprofile"),o=document.querySelector(".popup_type_addcard"),c=document.querySelector(".popup_type_editavatar");function a(e){"Escape"==e.key&&u(t)}function i(e){e.classList.add("popup_status_opened"),t=e,document.addEventListener("keydown",a)}function u(e){e.classList.remove("popup_status_opened"),document.removeEventListener("keydown",a)}var l="https://nomoreparties.co/v1/plus-cohort-8",s="2757d6a3-540a-4ca9-92d6-16077071be59",d={authorization:s,"Content-Type":"application/json"};function _(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var f=document.querySelector(".popup_type_picture"),m=f.querySelector(".form__main-image"),p=f.querySelector(".form__picture-capture"),v=document.querySelector(".elements__list");function y(e,t){e.classList.toggle(t)}function h(e,t){e.textContent=t,e.classList.remove("elements__num-heart_status_disabled")}function S(e,t,n,r,o,c,a,u){var d=r.cloneNode(!0),S=d.querySelector(".elements__image");S.src=t,S.alt=n,d.querySelector(".elements__image-caption-text").textContent=e;var b=d.querySelector(".elements__num-heart"),q=o.length,L=d.querySelector(".elements__heart");if(q>0&&(h(b,q),function(e,t){for(var n=0;n<t.length;++n)if(t[n]._id==e)return!0;return!1}(c,o)&&L.classList.remove("elements__heart_status_disabled")),L.addEventListener("click",(function(e){e.target.classList.contains("elements__heart_status_disabled")?function(e){return fetch("".concat(l,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:s}}).then(_)}(u).then((function(t){h(b,t.likes.length),y(e.target,"elements__heart_status_disabled")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(l,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:s}}).then(_)}(u).then((function(t){0==t.likes.length?b.classList.add("elements__num-heart_status_disabled"):h(b,t.likes.length),y(e.target,"elements__heart_status_disabled")})).catch((function(e){console.log(e)}))})),a==c){var E=d.querySelector(".elements__trash");E.addEventListener("click",(function(e){(function(e){return fetch("".concat(l,"/cards/").concat(e),{method:"DELETE",headers:{authorization:s}}).then(_)})(u).then((function(){var e;e=d,v.removeChild(e)})).catch((function(e){console.log(e)}))})),E.classList.remove("elements__trash_status_disabled")}return S.addEventListener("click",(function(n){i(f),m.src=t,m.alt=t,p.textContent=e})),d}function b(e){v.prepend(e)}var q="form__submit-button_type_inactive";function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var E,g=document.querySelector(".profile__title"),C=document.querySelector(".profile__subtitle"),k=document.querySelector(".profile__avatar"),x=document.querySelector(".popup__close_type_addcard"),A=document.querySelector(".popup__close_type_editprofile"),w=document.querySelector(".popup__close_type_picture"),T=document.querySelector(".popup__close_type_editavatar"),j=document.querySelector(".profile__edit-button"),D=document.querySelector(".profile__plus-button"),O=document.querySelector(".profile__avatar-wrapper"),P=r.querySelector(".form__item_el_name"),z=r.querySelector(".form__item_el_profession"),B=o.querySelector(".form__item_el_title"),N=o.querySelector(".form__item_el_ref"),I=c.querySelector(".form__item_el_avatar-ref"),J=document.querySelector(".form_type_editprofile"),H=document.querySelector(".form_type_addcard"),M=document.querySelector(".form_type_editavatar"),U=document.querySelector("#card-template").content.querySelector(".elements__item"),$=document.querySelectorAll(".popup__background");x.addEventListener("click",(function(e){u(o)})),A.addEventListener("click",(function(e){u(r)})),j.addEventListener("click",(function(e){i(r),P.value=g.textContent.trim(),z.value=C.textContent.trim()})),J.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=e.submitter;o.textContent="Сохранение...",(t=P.value,n=z.value,fetch("".concat(l,"/users/me"),{method:"PATCH",headers:d,body:JSON.stringify({name:t,about:n})}).then(_)).then((function(e){g.textContent=e.name,C.textContent=e.about,u(r)})).catch((function(e){console.log(e)})).finally((function(){o.textContent="Сохранить"}))})),D.addEventListener("click",(function(e){i(o)})),O.addEventListener("click",(function(e){i(c)})),H.addEventListener("submit",(function(t){t.preventDefault();var n,r,c=t.submitter;c.textContent="Сохранение...",(n=B.value.trim(),r=N.value.trim(),fetch("".concat(l,"/cards"),{method:"POST",headers:d,body:JSON.stringify({name:n,link:r})}).then(_)).then((function(t){b(S(t.name,t.link,t.name,U,t.likes,t.owner._id,t.owner._id,t._id)),B.value="",N.value="",u(o),e(c,q)})).catch((function(e){console.log(e)})).finally((function(){c.textContent="Создать"}))})),w.addEventListener("click",(function(e){u(f)})),T.addEventListener("click",(function(e){u(c)})),E={formSelector:".form__input-card",containerSelector:".form__input-container",inputSelector:".form__item",submitButtonSelector:".form__submit-button",inactiveButtonClass:q,inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"},Array.from(document.querySelectorAll(E.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(E.containerSelector)).forEach((function(e){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n(r,o,t),r.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,c,t),n(r,o,t)}))}))}(e,E)}))}));for(var F=function(e){$[e].addEventListener("click",(function(t){u($[e].closest(".popup"))}))},G=0;G<$.length;++G)F(G);Promise.all([fetch("".concat(l,"/users/me"),{headers:{authorization:s}}).then(_),fetch("".concat(l,"/cards"),{headers:d}).then(_)]).then((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],r=t[1];g.textContent=n.name,C.textContent=n.about,k.src=n.avatar,r.forEach((function(e){b(S(e.name,e.link,e.name,U,e.likes,n._id,e.owner._id,e._id))}))})).catch((function(e){console.log(e)})),M.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.submitter;n.textContent="Сохранение...",(t=I.value,fetch("".concat(l,"/users/me/avatar"),{method:"PATCH",headers:d,body:JSON.stringify({avatar:t})}).then(_)).then((function(e){k.src=I.value,u(c)})).catch((function(e){console.log(e)})).finally((function(){n.textContent="Сохранить"}))}))})();