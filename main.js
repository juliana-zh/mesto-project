(()=>{"use strict";function e(e,t){e.classList.add(t)}var t,n=function(t,n,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t)}(n,o.inactiveButtonClass):e(n,o.inactiveButtonClass)},o=document.querySelector(".popup_type_editprofile"),r=document.querySelector(".popup_type_addcard"),c=document.querySelector(".popup_type_editavatar");function a(e){"Escape"==e.key&&u(t)}function i(e){e.classList.add("popup_status_opened"),t=e,document.addEventListener("keydown",a)}function u(e){e.classList.remove("popup_status_opened"),document.removeEventListener("keydown",a)}var s="https://nomoreparties.co/v1/plus-cohort-8",l="2757d6a3-540a-4ca9-92d6-16077071be59",d={authorization:l,"Content-Type":"application/json"},_=document.querySelector(".popup_type_picture"),m=_.querySelector(".form__main-image"),f=_.querySelector(".form__picture-capture"),p=document.querySelector(".elements__list");function v(e,t){e.classList.toggle(t)}function h(e,t){e.textContent=t,e.classList.remove("elements__num-heart_status_disabled")}function y(e,t,n,o,r,c,a,u){var d=o.cloneNode(!0),y=d.querySelector(".elements__image");y.src=t,y.alt=n,d.querySelector(".elements__image-caption-text").textContent=e;var S=d.querySelector(".elements__num-heart"),q=r.length,L=d.querySelector(".elements__heart");if(q>0&&(h(S,q),function(e,t){for(var n=0;n<t.length;++n)if(t[n]._id==e)return!0;return!1}(c,r)&&L.classList.remove("elements__heart_status_disabled")),L.addEventListener("click",(function(e){e.target.classList.contains("elements__heart_status_disabled")?function(e){return fetch("".concat(s,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:l}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(u).then((function(t){h(S,t.likes.length),v(e.target,"elements__heart_status_disabled")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(s,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:l}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(u).then((function(t){0==t.likes.length?S.classList.add("elements__num-heart_status_disabled"):h(S,t.likes.length),v(e.target,"elements__heart_status_disabled")})).catch((function(e){console.log(e)}))})),a==c){var g=d.querySelector(".elements__trash");g.addEventListener("click",(function(e){(function(e){return fetch("".concat(s,"/cards/").concat(e),{method:"DELETE",headers:{authorization:l}}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))}))})(u).then((function(){var e;e=d,p.removeChild(e)})).catch((function(e){console.log(e)}))})),g.classList.remove("elements__trash_status_disabled")}return y.addEventListener("click",(function(n){i(_),m.src=t,f.textContent=e})),d}function S(e){p.prepend(e)}var q,L=document.querySelector(".profile__title"),g=document.querySelector(".profile__subtitle"),k=document.querySelector(".profile__avatar"),E=document.querySelector(".popup__close_type_addcard"),C=document.querySelector(".popup__close_type_editprofile"),b=document.querySelector(".popup__close_type_picture"),x=document.querySelector(".popup__close_type_editavatar"),j=document.querySelector(".profile__edit-button"),P=document.querySelector(".profile__plus-button"),A=document.querySelector(".profile__avatar-wrapper"),T=o.querySelector(".form__item_el_name"),w=o.querySelector(".form__item_el_profession"),D=r.querySelector(".form__item_el_title"),z=r.querySelector(".form__item_el_ref"),B=c.querySelector(".form__item_el_avatar-ref"),N=document.querySelector(".form_type_editprofile"),O=document.querySelector(".form_type_addcard"),J=document.querySelector(".form_type_editavatar"),H=document.querySelector("#card-template").content.querySelector(".elements__item"),M=document.querySelectorAll(".popup__background"),U="form__submit-button_type_inactive",F=".form__submit-button";E.addEventListener("click",(function(e){u(r)})),C.addEventListener("click",(function(e){u(o)})),j.addEventListener("click",(function(e){i(o),T.value=L.textContent.trim(),w.value=g.textContent.trim()})),N.addEventListener("submit",(function(e){e.preventDefault(),console.log(e.target);var t,n,r=e.target.querySelector(F);r.textContent="Сохранение...",(t=T.value,n=w.value,fetch("".concat(s,"/users/me"),{method:"PATCH",headers:d,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){L.textContent=e.name,g.textContent=e.about})).catch((function(e){console.log(e)})),u(o),r.textContent="Сохранить"})),P.addEventListener("click",(function(e){i(r)})),A.addEventListener("click",(function(e){i(c)})),O.addEventListener("submit",(function(t){t.preventDefault();var n,o,c=O.querySelector(F);c.textContent="Сохранение...",(n=D.value.trim(),o=z.value.trim(),fetch("".concat(s,"/cards"),{method:"POST",headers:d,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){S(y(e.name,e.link,e.name,H,e.likes,e.owner._id,e.owner._id,e._id)),D.value="",z.value=""})).catch((function(e){console.log(e)})),c.textContent="Создать",e(c,U),u(r)})),b.addEventListener("click",(function(e){u(_)})),x.addEventListener("click",(function(e){u(c)})),q={formSelector:".form__input-card",containerSelector:".form__input-container",inputSelector:".form__item",submitButtonSelector:F,inactiveButtonClass:U,inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"},Array.from(document.querySelectorAll(q.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(q.containerSelector)).forEach((function(e){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n(o,r,t),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,t),n(o,r,t)}))}))}(e,q)}))}));for(var G=function(e){M[e].addEventListener("click",(function(t){u(M[e].closest(".popup"))}))},I=0;I<M.length;++I)G(I);fetch("".concat(s,"/users/me"),{headers:{authorization:l}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return L.textContent=e.name,g.textContent=e.about,k.src=e.avatar,fetch("".concat(s,"/cards"),{headers:d}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){console.log(t),console.log(e._id),t.forEach((function(t){S(y(t.name,t.link,t.name,H,t.likes,e._id,t.owner._id,t._id))}))}))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)})),J.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.target.querySelector(F);n.textContent="Сохранение...",(t=B.value,fetch("".concat(s,"/users/me/avatar"),{method:"PATCH",headers:d,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){k.src=B.value})).catch((function(e){console.log(e)})),u(c),n.textContent="Сохранить"}))})();